\chapter{Mango Messenger}\label{ch:mango-messenger}


\section{Web API Documentation}\label{sec:web-api-documentation}

\subsection{Auth}\label{subsec:auth}
\begin{itemize}
        %% Register Endpoint
    \item \textbf{Endpoint}: /api/auth/register.
    \begin{itemize}
        \item \textbf{Description}: Registers user in a messenger.
        \item \textbf{Request type}: POST
        \item \textbf{Request body}:
        \begin{spverbatim}
        {
            "phoneNumber": "string",
            "email": "string",
            "displayName": "string",
            "password": "string",
            "verificationMethod": number,
            "termsAccepted": boolean
        }
        \end{spverbatim}
        \item  \textbf{Response example}:
        \begin{spverbatim}
        {
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}
        \item \textbf{Response codes}: 200 Success, 400 Bad Request
        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User already registered.
            \item Weak password.
            \item Invalid email.
            \item Invalid verification method.
            \item Invalid display name.
            \item Phone occupied.
        \end{enumerate}
    \end{itemize}
    %% Register Endpoint

    %% Verify Email Endpoint
    \item \textbf{Endpoint}: api/auth/verify-email

    \begin{itemize}

        \item \textbf{Description}: Sends verification request.
        User receives confirmation link via email.

        \item \textbf{Request type}: GET

        \item \textbf{Parameters}:

        \begin{enumerate}
            \item Email (required)
            \item User ID (required)
        \end{enumerate}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item Invalid user id.
            \item Email already verified.
        \end{enumerate}

    \end{itemize}
    %% Verify Email Endpoint

    %% Login Endpoint
    \item \textbf{Endpoint}: api/auth/login

    \begin{itemize}

        \item \textbf{Description}: Performs login to the messenger.

        \item \textbf{Request type}: POST

        \item \textbf{Payload}:

        \begin{spverbatim}
        {
            "email": "string",
            "password": "string"
        }
        \end{spverbatim}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "accessToken": "string",
            "refreshTokenId": "string",
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item Invalid credentials.
        \end{enumerate}
    \end{itemize}
    %% Login Endpoint

    %% Verify Phone Endpoint
    \item \textbf{Endpoint}: api/auth/verify-phone
    \begin{itemize}

        \item \textbf{Description}: Sends SMS to user phone.

        \item \textbf{Request type}: POST

        \item \textbf{Payload}:

        \begin{spverbatim}
        {
            "confirmationCode": integer
        }
        \end{spverbatim}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item Invalid or expired.
            \item Phone already verified
        \end{enumerate}
    \end{itemize}
    %% Verify Phone Endpoint

    %% Refresh Token Endpoint
    \item \textbf{Endpoint}: api/auth/refresh-token

    \begin{itemize}

        \item \textbf{Description}: Refreshes user's existing refresh token and access token.

        \item \textbf{Request type}: POST

        \item \textbf{Payload}:

        \begin{spverbatim}
        {
            "refreshTokenId": "string"
        }
        \end{spverbatim}


        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "refreshTokenId": "string",
            "accessToken": "string",
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400, 401

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item Invalid or empty refresh token.
        \end{enumerate}
    \end{itemize}
    %% Refresh Token Endpoint

    %% Logout Endpoint
    \item \textbf{Endpoint}: api/auth/logout

    \begin{itemize}

        \item \textbf{Description}: Logs out from current device.

        \item \textbf{Request type}: POST

        \item \textbf{Payload}:

        \begin{spverbatim}
        {
            "refreshTokenId": "string"
        }
        \end{spverbatim}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400, 401

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User not found.
            \item Invalid or empty refresh token.
        \end{enumerate}
    \end{itemize}
    %% Logout Endpoint

    %% Logout All Endpoint
    \item \textbf{Endpoint}: api/auth/logout-all

    \begin{itemize}

        \item \textbf{Description}: Logs out from all devices.

        \item \textbf{Request type}: POST

        \item \textbf{Payload}:

        \begin{spverbatim}
        {
            "refreshTokenId": "string"
        }
        \end{spverbatim}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400, 401

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User not found.
            \item Invalid or empty refresh token.
        \end{enumerate}
    \end{itemize}
        %% Logout All Endpoint

\end{itemize}

\subsection{Chats}\label{subsec:chats}
\begin{itemize}
        %% Get Chats Endpoint
    \item \textbf{Endpoint}: api/chats
    \begin{itemize}

        \item \textbf{Description}: Returns list of all user's chats.

        \item \textbf{Request type}: GET

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "chats": [
                {
                "title": "First Chat",
                "image": null,
                "lastMessageAuthor": "maintester@gmail.com",
                "lastMessage": "Second message",
                "lastMessageAt": "2021-07-06T19:41:23.597931"
            },
                {
                "title": "Second Chat",
                "image": null,
                "lastMessageAuthor": null,
                "lastMessage": null,
                "lastMessageAt": null
            }
            ],
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400, 401

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User not found.
        \end{enumerate}
    \end{itemize}
    %% Get Chats Endpoint

    %% Create Group
    \item \textbf{Endpoint}: api/chats/group

    \begin{itemize}
        \item \textbf{Description}: Creates new group of specified type.

        \item \textbf{Request type}: POST

        \item \textbf{Payload}:

        \begin{spverbatim}
        {
            "groupType": integer,
            "groupTitle": "string"
        }
        \end{spverbatim}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400, 401

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User not found.
        \end{enumerate}
    \end{itemize}
    %% Create Group

    %% Direct Chat Endpoint
    \item \textbf{Endpoint}: api/chats/direct-chat

    \begin{itemize}
        \item \textbf{Description}: Creates new group of specified type.

        \item \textbf{Request type}: POST

        \item \textbf{Payload}:

        \begin{spverbatim}
        {
            "partnerId": "string"
        }
        \end{spverbatim}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400, 401

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User not found.
        \end{enumerate}
    \end{itemize}
    %% Direct Chat Endpoint

    %% Group Join Endpoint
    \item \textbf{Endpoint}: api/chats/group/join/\{chatId\}

    \begin{itemize}
        \item \textbf{Description}: Creates new group of specified type.

        \item \textbf{Request type}: POST

        \item \textbf{Parameters}:

        \begin{enumerate}
            \item Chat id (required).
        \end{enumerate}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400, 401

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User not found.
        \end{enumerate}
    \end{itemize}
        %% Group Join Endpoint
\end{itemize}

\subsection{Messages}\label{subsec: messages}
\begin{itemize}
        %% Get Chat Messages Endpoint
    \item \textbf{Endpoint}: /api/messages/{chatId}

    \begin{itemize}
        \item \textbf{Description}: Returns chat including messages by chat id.


        \item \textbf{Request type}: GET

        \item \textbf{Parameters}:
        \begin{enumerate}
            \item Chat id (required).
        \end{enumerate}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "messages": [],
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400, 401

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User not found.
        \end{enumerate}
    \end{itemize}
    %% Get Chat Messages Endpoint

    %% Send Message Endpoint
    \item \textbf{Endpoint}: /api/messages

    \begin{itemize}
        \item \textbf{Description}: Sends message to particular chat

        \item \textbf{Request type}: POST

        \item \textbf{Payload}:

        \begin{spverbatim}
        {
            "content": "hello world",
            "chatId": 4
        }
        \end{spverbatim}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "chatMessage": {
            "userDisplayName": "string",
            "messageText": "string",
            "sentAt": "time-stamp",
            "editedAt": "time-stamp"
        },
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400, 401

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User not found.
        \end{enumerate}
    \end{itemize}
    %% Send Message Endpoint

    %% Edit Message Endpoint
    \item \textbf{Endpoint}: /api/messages

    \begin{itemize}
        \item \textbf{Description}: Updates particular message

        \item \textbf{Request type}: PUT

        \item \textbf{Payload}:

        \begin{spverbatim}
        {
            "messageId": 2,
            "modifiedText": "text"
        }
        \end{spverbatim}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400, 401

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User not found.
        \end{enumerate}
    \end{itemize}
    %% Edit Message Endpoint

    %% Delete Message Endpoint
    \item \textbf{Endpoint}: /api/messages/\{messageId\}

    \begin{itemize}
        \item \textbf{Description}: Updates particular message

        \item \textbf{Request type}: DELETE

        \item \textbf{Parameters}:

        \begin{itemize}
            \item Message id (required).
        \end{itemize}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User not found.
        \end{enumerate}
    \end{itemize}
        %% Delete Message Endpoint
\end{itemize}

\subsection{User}\label{subsec:user}
\begin{itemize}
        %% Get User Endpoint
    \item \textbf{Endpoint}: /api/users/{userId}
    \begin{itemize}

        \item \textbf{Description}: Updates particular message

        \item \textbf{Request type}: GET

        \item \textbf{Parameters}:

        \begin{enumerate}
            \item User id (required).
        \end{enumerate}

        \item \textbf{Response example}:

        \begin{spverbatim}
        {
            "user": {
            "username": "string",
            "displayName": "string",
            "bio": "string",
            "image": "string"
        },
            "message": "SUCCESS",
            "success": true
        }
        \end{spverbatim}

        \item \textbf{Response codes}: 200, 400, 401

        \item \textbf{Response messages}:
        \begin{enumerate}
            \item Success.
            \item User not found.
        \end{enumerate}
    \end{itemize}
        %% Get User Endpoint
\end{itemize}